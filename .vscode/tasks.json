{
    "version": "2.0.0",
    "inputs": [
        {
            "id": "target",
            "description": "Ledger device you want to use",
            "default": "NANOX",
            "type": "pickString",
            "options": [
                "NANOX",
                "NANOS",
                "NANOSP",
                "FLEX",
                "STAX"
            ]
        },
        {
            "id": "device",
            "description": "Ledger device you want to use",
            "default": "nanox",
            "type": "pickString",
            "options": [
                "nanox",
                "nanos",
                "nanosp",
                "flex",
                "stax"
            ]
        },
        {
            "id": "usecase",
            "description": "Use case",
            "default": "release",
            "type": "pickString",
            "options": [
                "release",
                "debug"
            ]
        },
        {
            "id": "variant",
            "description": "Variant",
            "default": "BOL",
            "type": "pickString",
            "options": [
                "BOL"
            ]
        }
    ],
    "tasks": [
        {
            "label": "Ledger - Git Submodule Update",
            "type": "shell",
            "command": "git submodule update --init --recursive",
            "group": "build",
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Ledger - Install Tests requirements",
            "type": "shell",
            "command": "apt install python3-dev qemu-user-static libgl1-mesa-glx libglib2.0-0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-render-util0 libxcb-shape0 libxcb-xinerama0 libxcb-xkb1 libxkbcommon-x11-0 libdbus-1-3",
            "group": "test",
        },
        {
            "label": "Ledger - Install Pytests requirements",
            "type": "shell",
            "command": "[ -f tests/requirements.txt ]; pip install --break-system-packages -r  tests/requirements.txt",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Tests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}",
                "env": {
                    "PATH": "${env:PATH}:/usr/lib/qt5/bin"
                }
            }
        },
        {
            "label": "Ledger - Golden run",
            "type": "shell",
            "command": "source ${workspaceFolder}/venv/bin/activate; pytest tests --tb=short -v --device ${input:device} --golden_run",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}",
            }
        },
        {
            "label": "Ledger - Kill Emulator",
            "type": "shell",
            "command": "pkill -f speculos",
            "group": "test",
        },
        {
            "label": "Ledger - Run Tests",
            "type": "shell",
            "command": "source ${workspaceFolder}/venv/bin/activate; pytest ./tests/ --tb=short -v --device ${input:device}",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Ledger - Run Tests with Display",
            "type": "shell",
            "command": "source ${workspaceFolder}/venv/bin/activate; pytest ./tests/ --tb=short -v --device ${input:device} --display",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Ledger - Run Tests with Display on Device - Execute",
            "type": "shell",
            "command": "source ${workspaceFolder}/venv/bin/activate; pytest ./tests/ --tb=short -v --device ${input:device} --display --backend ledgerwallet",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Ledger - Run with Emulator",
            "type": "shell",
            "command": "speculos --model ${input:device} ${workspaceFolder}/builddir/app.elf",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            }
        },
        {
            "label": "Ledger - Run with Emulator in debug",
            "type": "shell",
            "command": "speculos --model ${input:device} ${workspaceFolder}/builddir/app.elf -d",
            "group": "test",
            "dependsOn": [
                "Ledger - Install Pytests requirements"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
        }
    ]
}